---
version: '3.9'

services:
  neo4j:
    image: neo4j:${NEO4J_VERSION:-4.4.11-enterprise}
    # depends_on:
    #  - plugins-neo4j
    restart: always
    volumes:
      - lke_neo4j_data:/data
      # - /opt/linkurious/data/airflow-jobs/neo4j/import:/var/lib/neo4j/import
      # - /opt/linkurious/data/airflow-jobs/neo4j/export:/var/lib/neo4j/export
      # - /opt/linkurious/data/airflow-jobs/neo4j/plugins:/plugins
      # - /opt/linkurious/data/airflow-jobs/neo4j/query:/var/lib/neo4j/query
    environment:
      #- NEO4J_dbms_security_procedures_unrestricted=\*.\*
      - NEO4J_dbms_security_procedures_unrestricted=apoc.\*
      - NEO4J_apoc_export_file_enabled=true
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_apoc_import_file_use__neo4j__config=true
      - NEO4J_apoc_trigger_enabled=true
      - NEO4J_dbms_memory_heap_initial__size=2G
      - NEO4J_dbms_memory_heap_max__size=4G
      - NEO4J_dbms_memory_pagecache_size=2G
      # used to be : NEO4J_dbms_allow__format__migration=true
      - NEO4J_dbms_allow__upgrade=true
      # force password, otherwise neo4j/neo4j and will request reset
      - NEO4J_AUTH=neo4j/neo3j
      - NEO4J_ACCEPT_LICENSE_AGREEMENT=yes
    networks:
      - lke_network

volumes:
  lke_neo4j_data:

networks:
  lke_network:
